---
Index: "[[üè∑ Lecture Notes]]"
tags:
  - Linux
  - LInux/FileSystem
  - LInux/UnionMount
  - Container
status: InProcess
---

### 1. Overlay(Ïò§Î≤ÑÎ†àÏù¥) ÌååÏùº ÏãúÏä§ÌÖúÏóê Ïã§ÏäµÏóê ÏÇ¨Ïö©Ìï† Î¶¨ÏÜåÏä§ ÏÉùÏÑ±
```bash
# ÎîîÎ†âÌÑ∞Î¶¨ ÏÉùÏÑ±
[root@ubuntu2204] mkdir /tmp/{lower1,lower2,upper,merged,work}

# ÌååÏùº ÏÉùÏÑ±
[root@ubuntu2204] echo "lower1 a" > /tmp/lower1/a.txt
[root@ubuntu2204] echo "lower1 b" > /tmp/lower1/b.txt
[root@ubuntu2204] echo "lower2 a" > /tmp/lower2/a.txt
[root@ubuntu2204] echo "lower2 b" > /tmp/lower2/b.txt
[root@ubuntu2204] echo "lower2 c" > /tmp/lower2/c.txt
```

### 2. ÏùΩÍ∏∞ Ï†ÑÏö©(ro) Ïò§Î≤ÑÎ†àÏù¥ ÏÉùÏÑ± Î∞è ÌôïÏù∏, umount
```bash
# ÏùΩÍ∏∞ Ï†ÑÏö© Ïò§Î≤ÑÎ†àÏù¥ ÏÉùÏÑ± Î∞è ÎßàÏö¥Ìä∏
[root@ubuntu2204] sudo mount -t overlay overlay \
> -o lowerdir=/tmp/lower1:/tmp/lower2 \
> /tmp/merged
```
- `-t`
	- ÌååÏùº ÏãúÏä§ÌÖú Ï¢ÖÎ•òÎ•º ÏßÄÏ†ïÌï©ÎãàÎã§.
- `-o`
	- ÎßàÏö¥Ìä∏Î•º Ï†ÅÏö©Ìï† Îïå Ï†ÅÏö©Ìï† Ï∂îÍ∞ÄÏ†ÅÏù∏ ÎßàÏö¥Ìä∏ ÏòµÏÖòÏùÑ ÏßÄÏ†ïÌï©ÎãàÎã§.
	- ÏòµÏÖòÎì§ÏùÄ ÏâºÌëúÎ°ú Íµ¨Î∂ÑÌïòÏó¨ Ïó¨Îü¨ Í∞úÎ•º ÏßÄÏ†ïÌï† Ïàò ÏûàÏäµÎãàÎã§.
	- ÌååÏùº ÏãúÏä§ÌÖú Ï¢ÖÎ•òÎßàÎã§ ÏßÄÏõêÌïòÎäî ÏòµÏÖòÎì§Ïù¥ Îã§Î¶ÖÎãàÎã§.
		- Ïó¨Í∏∞ÏÑúÎäî `overlay` ÌååÏùº ÏãúÏä§ÌÖúÏùò ÏòµÏÖòÏù∏ `lowerdir`Î•º ÏßÄÏ†ïÌñàÏäµÎãàÎã§.
- `lowerdir=/tmp/lower1:/tmp/lower2`
	- `lowerdir=`
		- `overlay` ÌååÏùº ÏãúÏä§ÌÖúÏùò Í≥ÑÏ∏µÏ†ÅÏù∏ Íµ¨Ï°∞ÏóêÏÑú ÏïÑÎûòÏóê ÍπîÎ¶¨Îäî `lowerdir`Î•º ÏßÄÏ†ïÌï©ÎãàÎã§.
		- `lowerdir`Îäî `ro(read-only)`ÏûÖÎãàÎã§.
		- `:` Î°ú Íµ¨Î∂ÑÌïòÏó¨ Ïó¨Îü¨ Ï∏µÏùÑ ÏßÄÏ†ïÌï† Ïàò ÏûàÏäµÎãàÎã§. ÏôºÏ™ΩÎ∂ÄÌÑ∞ ÏïÑÎûòÏóê ÍπîÎ¶ΩÎãàÎã§.
	- `/tmp/lower1:/tmp/lower2`
		- `ro`Ïù∏ `lowerdir`Î°ú ÏßÄÏ†ïÎêú ÎîîÎ†âÌÑ∞Î¶¨ÏûÖÎãàÎã§.
		- ÏôºÏ™ΩÏóêÏÑúÎ∂ÄÌÑ∞ ÏïÑÎûòÏóê ÍπîÎ¶¨ÎØÄÎ°ú `/tmp/lower1`Ïù¥ ÏïÑÎûòÏóê ÍπîÎ¶¨Í≥†, `/tmp/lower2`Í∞Ä ÏúÑÏóê Ïò¨ÎùºÍ∞ëÎãàÎã§.

```bash
# ÌôïÏù∏
[root@ubuntu2204] mount | grep overlay
overlay on /tmp/merged type overlay (ro,relatime,lowerdir=/tmp/lower1:/tmp/lower2)
```


### 3. ro Ïò§Î≤ÑÎ†àÏù¥Ïóê ÌååÏùº ÏÉùÏÑ±
```bash
# ÏùΩÍ∏∞ Ï†ÑÏö© Ïò§Î≤ÑÎ†àÏù¥Îùº ÌååÏùº ÏÉùÏÑ±Ïù¥ ÏïàÎêúÎã§.
[root@ubuntu2204:/tmp] echo "hello ro" > /tmp/merged/d.txt
bash: /tmp/merged/d.txt: Read-only file system
[root@ubuntu2204:/tmp] ll > /tmp/merged/d.txt
bash: /tmp/merged/d.txt: Read-only file system

# umount
[root@ubuntu2204:/tmp] umount /tmp/merged

# umount ÌôïÏù∏
[root@ubuntu2204:/tmp] mount | grep overlay
[root@ubuntu2204:/tmp]
```


### 4. ÏùΩÍ∏∞/Ïì∞Í∏∞(rw) Ïò§Î≤ÑÎ†àÏù¥ ÏÉùÏÑ± Î∞è ÌôïÏù∏
```bash
# ÏùΩÍ∏∞/Ïì∞Í∏∞ Ïò§Î≤ÑÎ†àÏù¥ ÏÉùÏÑ± Î∞è mount
[root@ubuntu2204:/tmp] mount -t overlay overlay -o lowerdir=/tmp/lower1:/tmp/lower2,upperdir=/tmp/upper/,workdir=/tmp/work/ /tmp/merged

# ÌôïÏù∏
[root@ubuntu2204:/tmp] mount | grep overlay
overlay on /tmp/merged type overlay (rw,relatime,lowerdir=/tmp/lower1:/tmp/lower2,upperdir=/tmp/upper/,workdir=/tmp/work/)
```


### 5. Ïò§Î≤ÑÎ†àÏù¥Ïóê ÌååÏùº ÏÉùÏÑ±
```bash
[root@ubuntu2204:/tmp] echo "Hello World" > /tmp/merged/hello.txt
[root@ubuntu2204:/tmp] ll /tmp/merged
total 24
drwxr-xr-x  1 root root 4096 May 21 11:43 ./
drwxrwxrwt 18 root root 4096 May 21 11:38 ../
-rw-r--r--  1 root root    9 May 21 10:33 a.txt
-rw-r--r--  1 root root    9 May 21 10:33 b.txt
-rw-r--r--  1 root root    9 May 21 10:34 c.txt
-rw-r--r--  1 root root   12 May 21 11:43 hello.txt


[root@ubuntu2204:/tmp] cd /tmp/upper/
[root@ubuntu2204:/tmp/upper] ll
total 12
drwxr-xr-x  2 root root 4096 May 21 11:43 ./
drwxrwxrwt 18 root root 4096 May 21 11:38 ../
-rw-r--r--  1 root root   12 May 21 11:43 hello.txt
```

### 6. umount
```bash
[root@ubuntu2204:/tmp/upper] cd /
[root@ubuntu2204:/] umount /tmp/merged
[root@ubuntu2204:/] mount | grep overlay
```


### 7. dockerÏóêÏÑú Union Mount FileSystem ÏÇ¨Î°Ä ÌôïÏù∏
```bash
[root@ubuntu2204:/] sudo apt install -y docker.io

[root@ubuntu2204:/] docker pull nginx

[root@ubuntu2204:/] docker images
REPOSITORY   TAG       IMAGE ID       CREATED       SIZE
nginx        latest    a5cdc6683c84   4 weeks ago   198MB

[root@ubuntu2204:/] docker run --rm -d nginx
fb24e6053ca2ca264bcb847df1e403f09f5e6267c6db3b70d62a4bfad49dc8ed

[root@ubuntu2204:/] mount | grep overlay
overlay on /var/lib/docker/overlay2/c73a07e8e8a8da3eb774ebb58d535bccef5c8d4cc15952d1ec49bbcbc904f6fb/merged type overlay (rw,relatime,lowerdir=/var/lib/docker/overlay2/l/VO62JVC2MNTQOMNDTIGLFWANE6:/var/lib/docker/overlay2/l/IP26MXPU63ITXGLUN66UMBKIMR:/var/lib/docker/overlay2/l/CGSTDTOFCMALLP2S3Y33Y3GVG4:/var/lib/docker/overlay2/l/S6KJNQFCKSPQBRSVWOVIIPCZXQ:/var/lib/docker/overlay2/l/TB4IKMZK2BXQC4QT4NAFEFPF7C:/var/lib/docker/overlay2/l/GKZ2MHZTTJQT4R3F2YK27BFRHJ:/var/lib/docker/overlay2/l/QVILPZDUJH2ZNP3KGOAFVUL4A5:/var/lib/docker/overlay2/l/BY4HHUKCT5ZPN5CWDZVTGAVXUN,upperdir=/var/lib/docker/overlay2/c73a07e8e8a8da3eb774ebb58d535bccef5c8d4cc15952d1ec49bbcbc904f6fb/diff,workdir=/var/lib/docker/overlay2/c73a07e8e8a8da3eb774ebb58d535bccef5c8d4cc15952d1ec49bbcbc904f6fb/work)
```